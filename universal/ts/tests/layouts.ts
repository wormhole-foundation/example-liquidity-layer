import { deserializeLayout, encoding } from "@wormhole-foundation/sdk";
import { expect } from "chai";
import {
    fastFillLayout,
    fastMarketOrderLayout,
    fillLayout,
    slowOrderResponseLayout,
    wormholeCctpDepositHeaderLayout,
} from "../src/layouts";
const fillPayloads = [
    {
        header: "000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000001000000000000e02200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000000000000000002adf8b30d4dd24a05ccd9afbdc06a5b49c9c758d006401000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
        fill: "01000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
    },
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b9aca000000000100000000000000000001a37100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401000600000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01000600000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000006000000000000e02300000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a006401000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000000000000000002455500000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b9aca000000000100000006000000000001a37200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a006401000600000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01000600000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000001000000000002455600000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000000000000000002adf8b30d4dd24a05ccd9afbdc06a5b49c9c758d006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b66e8c00000000100000000000000000001a3730000000000000000000000003e5e9111ae8eb78fe1cc3bb8915d5d461f3ef9a9000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b7f14400000000100000000000000000001a37400000000000000000000000028a8746e75304c0780e011bed21c72cd78cd535e000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b9943600000000100000000000000000001a375000000000000000000000000e11ba2b4d45eaed5996cd0823791e0c93114882d000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000b97ef9ef8734c71904d8002f8b6bc66dd9c48a6e000000000000000000000000000000000000000000000000000000003b9943600000000100000000000000000001a376000000000000000000000000e11ba2b4d45eaed5996cd0823791e0c93114882d000000000000000000000000eeb3a6143b71b9ebc867479f2cf57db0be4604c2006401001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //Fill:  01001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
];

describe("Fill Payload Tests", () => {
    it("Can deserialize a header", () => {
        const rawHeader = encoding.hex.decode(fillPayloads[0].header);
        const rawFill = encoding.hex.decode(fillPayloads[0].fill);

        const deserializedHeader = deserializeLayout(wormholeCctpDepositHeaderLayout, rawHeader);
        const equiv = encoding.bytes.equals(deserializedHeader.payload, rawFill);
        expect(equiv).to.be.true;

        const deserializedFill = deserializeLayout(fillLayout, rawFill);
        console.log(deserializedFill);
    });
});
const slowPayloads = [
    {
        header: "000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000001000000000002455700000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0",
        slowResponse: "0200000000000186a0",
        fastMarketOrder:
            "0b000000003b9aca0000000000000000000002000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f000000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000970fe000000000000186a000000000001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
    },
    //WormholeCctpDepositHeader.decode:  000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000001000000000002455800000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0
    //SlowOrderResponse:  0200000000000186a0
    //FastMarketOrder:  0b000000003b9aca0000000000000000000002000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f000000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000970fe000000000000186a000000000001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //
    //WormholeCctpDepositHeader.decode:  000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000001000000000002455900000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0
    //SlowOrderResponse:  0200000000000186a0
    //FastMarketOrder:  0b000000003b9aca0000000000000000000002000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f000000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000970fe000000000000186a000000000001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
];

describe("Slow payload tests", () => {
    it("Can deserialize a header", () => {
        const rawHeader = encoding.hex.decode(slowPayloads[0].header);
        const rawSlowResponse = encoding.hex.decode(slowPayloads[0].slowResponse);
        const rawFastMarketOrder = encoding.hex.decode(slowPayloads[0].fastMarketOrder);

        const deserializedHeader = deserializeLayout(wormholeCctpDepositHeaderLayout, rawHeader);
        const equiv = encoding.bytes.equals(deserializedHeader.payload, rawSlowResponse);
        expect(equiv).to.be.true;

        const deserializedSlowResponse = deserializeLayout(
            slowOrderResponseLayout,
            rawSlowResponse,
        );
        console.log(deserializedSlowResponse);

        const deserializedFastMarketOrder = deserializeLayout(
            fastMarketOrderLayout,
            rawFastMarketOrder,
        );
        console.log(deserializedFastMarketOrder);
    });
});

const fastFillPayloads = [
    {
        header: "000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000003b9aca000000000600000001000000000002455e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0",
        slowResponse: "0200000000000186a0",
        fastFill:
            "0c000000003b994360001e00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
    },
    // {
    //     header: "000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000001000000000000e02800000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0",
    //     slowResponse: "0200000000000186a0",
    //     fastMarketOrder:
    //         "0b000000003b9aca0000000000000000000006000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f000000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000970fe000000000000186a000000000001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
    //     fastFill:
    //         "0c000000003b66e8c0000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e",
    // },
    //WormholeCctpDepositHeader.decode:  000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000001000000000000e02900000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0
    //SlowOrderResponse:  0200000000000186a0
    //FastMarketOrder:  0b000000003b9aca0000000000000000000006000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f000000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c10000000000970fe000000000000186a000000000001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //FastFill:  0c000000003b7f1440000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000001000000000000e02a00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0
    //SlowOrderResponse:  0200000000000186a0
    //FastFill:  0c000000003b994360000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
    //WormholeCctpDepositHeader.decode:  000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000003b9aca000000000000000001000000000000e02b00000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c100000000000000000000000027d44c7337ce4d67b7cd573e9c36bdeed2b2162a00090200000000000186a0
    //SlowOrderResponse:  0200000000000186a0
    //FastFill:  0c000000003b994360000200000000000000000000000090f8bf6a479f320ead074411a4b0e7944ea8c9c1000000000000000000000000ffcf8fdee72ac11b5c542428b35eef5769c409f0001f416c6c20796f75722062617365206172652062656c6f6e6720746f2075732e
];

// TODO: failing on src chain id 0
describe("Fast Fill payload tests", () => {
    it("Can deserialize a header", () => {
        const rawHeader = encoding.hex.decode(fastFillPayloads[0].header);
        const rawSlowResponse = encoding.hex.decode(fastFillPayloads[0].slowResponse);
        const rawFastFill = encoding.hex.decode(fastFillPayloads[0].fastFill);

        const deserializedHeader = deserializeLayout(wormholeCctpDepositHeaderLayout, rawHeader);
        const equiv = encoding.bytes.equals(deserializedHeader.payload, rawSlowResponse);
        expect(equiv).to.be.true;

        const deserializedSlowResponse = deserializeLayout(
            slowOrderResponseLayout,
            rawSlowResponse,
        );
        console.log(deserializedSlowResponse);

        const deserializedFastFill = deserializeLayout(fastFillLayout, rawFastFill);
        console.log(deserializedFastFill);
    });
});
